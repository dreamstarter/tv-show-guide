<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nikki & Calendar Nov 2025 – Oct 2026</title>
<style>
:root{
  --bg: #0f1115; /* dark base */
  --panel: #161a22;
  --text: #e6e9ef;
  --muted: #a0a7b4;
  --border: #2a2f3a;
  --accent: #46c2a5;
  --accent-2: #5aa0ff;
  --danger: #ff6b6b;
  --chip-hulu: #1dbf5c;
  --chip-peacock: #0075d6;
  --chip-paramount: #d93232;
}
@media (prefers-color-scheme: light){
  :root{
    --bg:#f8f9fb; --panel:#ffffff; --text:#1b1f27; --muted:#6b7380; --border:#e6e8ee;
    --accent:#1aa37d; --accent-2:#2e77ff; --danger:#d83c3c;
  }
}
html, body { height:100%; }
body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text); }
.container{ max-width:1100px; margin:0 auto; padding:16px; }
h1{ margin:12px 0 4px; font-size:22px; }
h2 { margin: 18px 0 8px; page-break-before: auto; font-size:18px; }
table { border-collapse: collapse; width: 100%; table-layout: fixed; background:var(--panel); border:1px solid var(--border); }
th, td { border: 1px solid var(--border); vertical-align: top; padding: 6px; font-size: 13px; }
thead th { background:rgba(255,255,255,0.03); position:sticky; top:0; z-index:1; }
span { display:inline-block; margin:1px 2px; padding:1px 6px; border-radius:4px; color:#fff; }
.hulu { background:var(--chip-hulu); }
.peacock { background:var(--chip-peacock); }
.paramount { background:var(--chip-paramount); }
.legend-table { width:100%; margin-bottom:16px; background:var(--panel); }
.legend-table td { padding:6px; font-size:12px; border:1px solid var(--border); }
.shows {font-size: 13px; line-height:1.35; }
.toolbar { position:sticky; top:0; z-index:5; background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0)) , var(--bg); padding:10px 0 6px; backdrop-filter: blur(6px); }
.toggle-bar { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
.btn { background:var(--panel); color:var(--text); border:1px solid var(--border); padding:8px 12px; border-radius:8px; cursor:pointer; font-size:12px; }
.btn:hover{ border-color: var(--accent-2); }
.btn.primary{ background: var(--accent-2); color:#fff; border-color: transparent; }
.btn.active { outline:2px solid var(--accent); }
.view { margin-top:12px; }
.hidden { display:none; }
.filters { margin:8px 0 12px; display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
.filters label { cursor:pointer; }
.chip { display:inline-block; padding:2px 8px; border-radius:16px; color:#fff; margin-left:6px; font-size:11px; }
.ended { text-decoration: line-through; opacity: 0.65; }
.muted { color:var(--muted); font-size: 11px; }
.meta { color:var(--muted); font-size:11px; margin-left:6px; }
.panel { border:1px solid var(--border); padding:10px; border-radius:10px; background:var(--panel); }
.panel h3 { margin-top:0; }
.editor table { width:100%; border-collapse: collapse; background:var(--panel); }
.editor th, .editor td { border:1px solid var(--border); padding:6px; font-size:12px; }
.editor input[type="number"]{ width:70px; }
.editor input[type="date"]{ width:140px; }
.editor select{ width:120px; }
.controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 10px; }
.pill { display:inline-flex; align-items:center; gap:6px; background:var(--panel); border:1px solid var(--border); padding:6px 10px; border-radius:999px; }
.badge { background: var(--accent); color:#081017; padding:2px 6px; border-radius:10px; font-weight:600; font-size:11px; }
input[type="date"]{ background:var(--panel); border:1px solid var(--border); color:var(--text); border-radius:6px; padding:6px; }
@media print {
  body { margin:0; }
  h2 { page-break-after: avoid; }
  .toggle-bar { display:none; }
  .filters { display:none; }
  details { display:none; }
}
</style>
</head>
<body>
<div class="container">
<div class="toolbar">
  <h1>TV Show Guide</h1>
  <div class="toggle-bar">
    <button id="btnAll" class="btn active" type="button">All Shows</button>
    <button id="btnWeek" class="btn" type="button">Week Airing</button>
    <div class="pill"><span class="muted">Timezone</span><span class="badge">EST · Indianapolis</span></div>
    <span style="flex:1 1 auto"></span>
    <button id="importBtn" class="btn" type="button">Import JSON</button>
    <button id="exportBtn" class="btn" type="button">Export JSON</button>
    <input type="file" id="importFile" accept="application/json" style="display:none" />
  </div>
</div>
<p class="muted">Toggle between all shows and the weekly airing grid. Enter premiere windows below to display SxxEyy for each airing date. Platform chips are colored; no separate key.</p>
<div class="filters">
  <strong>Platform Filters:</strong>
  <label><input type="checkbox" id="pf-hulu" checked> <span class="hulu chip">Hulu</span></label>
  <label><input type="checkbox" id="pf-peacock" checked> <span class="peacock chip">Peacock</span></label>
  <label><input type="checkbox" id="pf-paramount" checked> <span class="paramount chip">Paramount+</span></label>
  <span style="margin-left:8px; color:#555">(uncheck to hide a platform)</span>
  <span style="flex:1 1 auto"></span>
  <label><input type="checkbox" id="show-nonret"> <span class="chip" style="background:var(--border); color:var(--text)">Show non-returning</span></label>
  <span style="flex-basis:100%"></span>
  <label class="pill">Use default eps <input type="checkbox" id="use-estimates" checked></label>
  <label><input type="checkbox" id="est-abc" checked> ABC</label>
  <label><input type="checkbox" id="est-nbc" checked> NBC</label>
  <label><input type="checkbox" id="est-cbs" checked> CBS</label>
  <label><input type="checkbox" id="est-fox" checked> FOX</label>
</div>

<h2>Legend</h2>
<table class="legend-table" id="legendTable"></table>

<details class="panel editor" id="editor">
  <summary><strong>Edit Season Data (start/end dates, season, episodes, air day, returning)</strong></summary>
  <p class="muted">Tip: Fill real dates to enable SxxEyy per-day calculation. Your edits save to this browser only.</p>
  <div id="editWrap"></div>
  <div style="margin-top:8px">
    <textarea id="pasteJson" rows="6" style="width:100%; background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:8px; padding:8px;" placeholder='Paste JSON matching {"9": {"s":2, "start":"2025-11-07", "end":"2026-03-20", "eps":18, "air":"Friday", "ret":true}, ...}'></textarea>
    <div style="margin-top:6px"><button id="loadPaste" class="btn" type="button">Load from Paste</button></div>
  </div>
</details>

<div id="viewAll" class="view">
  <h2>All Shows (Alphabetical)</h2>
  <div id="allList" class="shows"></div>
</div>
<div id="viewWeek" class="view hidden">
  <div class="controls">
    <button id="prevWeek" class="btn" type="button">⟨ Prev Week</button>
    <button id="thisWeek" class="btn" type="button">This Week</button>
    <button id="nextWeek" class="btn" type="button">Next Week ⟩</button>
    <label class="pill">Jump to date <input type="date" id="jumpDate"></label>
    <span id="weekRange" class="muted"></span>
  </div>
  <div id="weekTable"></div>
</div>

<script>
// Optional preload data now expanded with remaining fall premiere dates & cancellations gathered from network schedule pages.
// Schema: { id: { s:season, start:YYYY-MM-DD, end:YYYY-MM-DD?, eps:Int?, air:FullDayName, ret:Boolean } }
const PRELOAD_SEASON_DATA = {
  // High Potential S2 (ABC) – Sept 16
  "15": { "s": 2, "start": "2025-09-16", "air": "Tuesday", "ret": true },
  // Doc S2 (Fox) – Sept 23
  "8": { "s": 2, "start": "2025-09-23", "air": "Tuesday", "ret": true },
  // Brilliant Minds S2 (NBC) – Sept 22
  "4": { "s": 2, "start": "2025-09-22", "air": "Monday", "ret": true },
  // Law & Order block (NBC) – Sept 25
  "17": { "s": 25, "start": "2025-09-25", "air": "Thursday", "ret": true },
  "18": { "s": 5,  "start": "2025-09-25", "air": "Thursday", "ret": true },
  "19": { "s": 27, "start": "2025-09-25", "air": "Thursday", "ret": true },
  // One Chicago (NBC) – Oct 1
  "5": { "s": 14, "start": "2025-10-01", "air": "Wednesday", "ret": true },
  "6": { "s": 11, "start": "2025-10-01", "air": "Wednesday", "ret": true },
  "7": { "s": 13, "start": "2025-10-01", "air": "Wednesday", "ret": true },
  // ABC Thursday block – Oct 9
  "1": { "s": 9,  "start": "2025-10-09", "air": "Thursday", "ret": true },
  "3": { "s": 1,  "start": "2025-10-09", "air": "Thursday", "ret": true },
  "13":{ "s": 22, "start": "2025-10-09", "air": "Thursday", "ret": true },
  // Shifting Gears S2 (ABC) – Oct 1
  "27": { "s": 2, "start": "2025-10-01", "air": "Wednesday", "ret": true },
  // Matlock S2 (CBS) – Oct 12
  "20":{ "s": 2,  "start": "2025-10-12", "air": "Thursday", "ret": true },
  // Elsbeth S3 (CBS) – Oct 16
  "9": { "s": 3, "start": "2025-10-16", "air": "Thursday", "ret": true },
  // Watson S2 (CBS) – Oct 13
  "31":{ "s": 2,  "start": "2025-10-13", "air": "Monday", "ret": true },
  // Murder in a Small Town S2 (Fox) – Sept 23
  "21": { "s": 2, "start": "2025-09-23", "air": "Tuesday", "ret": true },
  // Fire Country S4 (CBS) – Oct 17
  "10":{ "s": 4,  "start": "2025-10-17", "air": "Friday", "ret": true },
  // Tracker S3 (CBS) – Oct 19
  "30":{ "s": 3,  "start": "2025-10-19", "air": "Sunday", "ret": true },
  // Midseason / TBD (no premiere date yet, keep placeholders)
  "2": { "ret": true, "air": "Tuesday" },      // 9-1-1: Lone Star midseason
  "32": { "ret": true, "air": "Tuesday" },     // Will Trent midseason
  // Cancellations / final seasons concluded (kept for optional visibility toggle)
  "12":{ "ret": false },
  "28":{ "ret": false },
  "22":{ "ret": false },
  "25":{ "ret": false },
  "24":{ "ret": false },
  "11":{ "ret": false },
  "16":{ "ret": false },
  "23":{ "ret": false },
  "26":{ "ret": false },
  "29":{ "ret": false }
};
const span = (n,c)=>`<span class="${c}">${n}</span>`;
// Episode defaults by network when estimates are enabled
const EPS_DEFAULTS = { ABC: 18, NBC: 22, CBS: 20, FOX: 13 };
// Prefer Peacock for NBC and Paramount+ for CBS over Hulu when available.
// Prefer Peacock for NBC and Paramount+ for CBS over Hulu when available.
// Added season fields: s (season number), start/end (YYYY-MM-DD), eps (episode count), air (Sun..Sat), ret (returning boolean)
const shows = {
  1:{t:'911',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
  2:{t:'911 Lonestar',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:true},
  3:{t:'911 Nashville',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
  4:{t:'Brilliant Minds',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Monday',ret:true},
  5:{t:'Chicago Fire',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:true},
  6:{t:'Chicago Med',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:true},
  7:{t:'Chicago PD',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:true},
  8:{t:'Doc',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:true},
  9:{t:'Elsbeth',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 10:{t:'Fire Country',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Friday',ret:true},
 11:{t:'Found',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:false},
 12:{t:'The Good Doctor',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:false},
 13:{t:'Grey\'s Anatomy',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 14:{t:'High County',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 15:{t:'High Potential',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:true},
 16:{t:'The Irrational',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:false},
 17:{t:'Law & Order',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 18:{t:'L&O: Organized Crime',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 19:{t:'L&O: SVU',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 20:{t:'Matlock',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Thursday',ret:true},
 21:{t:'Murder in a Small Town',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:true},
 22:{t:'New Amsterdam',c:'peacock',net:'NBC',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:false},
 23:{t:'The Cleaning Lady',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Friday',ret:false},
 24:{t:'The Conners',c:'peacock',net:'ABC',s:null,start:'',end:'',eps:null,air:'Friday',ret:false},
 25:{t:'The Resident',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:false},
 26:{t:'Rescue: Hi Surf',c:'hulu',net:'FOX',s:null,start:'',end:'',eps:null,air:'Monday',ret:false},
 27:{t:'Shifting Gears',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Wednesday',ret:true},
 28:{t:'Station 19',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Thursday',ret:false},
 29:{t:'SWAT',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Friday',ret:false},
 30:{t:'Tracker',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Sunday',ret:true},
 31:{t:'Watson',c:'paramount',net:'CBS',s:null,start:'',end:'',eps:null,air:'Monday',ret:true},
 32:{t:'Will Trent',c:'hulu',net:'ABC',s:null,start:'',end:'',eps:null,air:'Tuesday',ret:true}
};
const dayOrder = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
function byDay(){
  const map = {Sunday:[],Monday:[],Tuesday:[],Wednesday:[],Thursday:[],Friday:[],Saturday:[]};
  Object.keys(shows).forEach(k=>{
    const s = shows[k];
    if(s.air && map[s.air]) map[s.air].push(parseInt(k));
  });
  return map;
}
function renderLegend(){
  const tbl = document.getElementById('legendTable');
  const includeNonRet = document.getElementById('show-nonret').checked;
  const nums = Object.keys(shows)
    .map(k=>parseInt(k))
    .sort((a,b)=>a-b)
    .filter(n=> includeNonRet || shows[n].ret !== false);
  let rows = '';
  for(let i=0;i<nums.length;i+=4){
    const cells = nums.slice(i,i+4).map(n=>{
      const s = shows[n];
      const cls = s.ret ? '' : 'ended';
      const end = endDateFor(s);
      const dates = s.start ? `S${s.s||'?'}: ${s.start}${end? ' – '+end: ''}` : 'Season dates: TBD';
      return `<td><span class="${s.c}">${n}</span> <span class="${cls}">${s.t}</span><span class="meta">${dates}</span></td>`;
    }).join('');
    rows += `<tr>${cells}</tr>`;
  }
  tbl.innerHTML = rows;
}
function renderAll(){
  const container = document.getElementById('allList');
  const selected = getSelectedPlatforms();
  const includeNonRet = document.getElementById('show-nonret').checked;
  const items = Object.keys(shows)
    .map(k=>parseInt(k))
    .sort((a,b)=>a-b)
    .filter(n=> selected.has(shows[n].c) && (includeNonRet || shows[n].ret !== false))
    .map(n=>{
      const s = shows[n];
      const cls = s.ret ? '' : 'ended';
      const end = endDateFor(s);
      const dates = s.start ? ` <span class="meta">(S${s.s||'?'}: ${s.start}${end? ' – '+end: ''})</span>` : '';
      return `${span(n,s.c)} <span class="${cls}">${s.t}</span>${dates}`;
    });
  container.innerHTML = items.join('<br>');
}
function startOfWeek(d){
  const x = new Date(d);
  x.setHours(0,0,0,0);
  const dow = x.getDay();
  x.setDate(x.getDate() - dow); // Sunday
  return x;
}
function fmt(d){
  const m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return `${m[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
}
function pad(n){ return (n<10?'0':'')+n; }
function effectiveEpisodes(show){
  // explicit eps wins
  if(show && typeof show.eps === 'number' && show.eps > 0) return show.eps;
  // use per-network defaults if enabled
  const use = document.getElementById('use-estimates')?.checked;
  if(!use) return null;
  const netFlags = {
    ABC: document.getElementById('est-abc')?.checked,
    NBC: document.getElementById('est-nbc')?.checked,
    CBS: document.getElementById('est-cbs')?.checked,
    FOX: document.getElementById('est-fox')?.checked
  };
  const net = show?.net;
  if(net && netFlags[net] && EPS_DEFAULTS[net]) return EPS_DEFAULTS[net];
  return null;
}
function endDateFor(show){
  if(show && show.end) return show.end;
  const eps = effectiveEpisodes(show);
  if(!show || !show.start || !eps) return '';
  const start = new Date(show.start + 'T00:00:00');
  const last = new Date(start);
  last.setDate(start.getDate() + (eps - 1) * 7);
  return `${last.getFullYear()}-${pad(last.getMonth()+1)}-${pad(last.getDate())}`;
}
function episodeForDate(show, date){
  const eps = effectiveEpisodes(show);
  if(!show || !show.start || !eps || !show.s) return '';
  const start = new Date(show.start + 'T00:00:00');
  if(date < start) return '';
  const diffDays = Math.floor((date - start)/ (1000*60*60*24));
  const weeks = Math.floor(diffDays/7);
  const ep = weeks + 1;
  if(ep < 1 || ep > eps) return '';
  return `S${pad(show.s)}E${pad(ep)}`;
}
function renderWeek(){
  const wrap = document.getElementById('weekTable');
  const selected = getSelectedPlatforms();
  const includeNonRet = document.getElementById('show-nonret').checked;
  const sow = currentWeekStart();
  const eow = new Date(sow); eow.setDate(eow.getDate()+6);
  document.getElementById('weekRange').textContent = `${fmt(sow)} – ${fmt(eow)}`;
  const map = byDay();
  let html = '<table><thead><tr>' + dayOrder.map(d=>`<th>${d}</th>`).join('') + '</tr></thead><tbody><tr>';
  for(let i=0;i<7;i++){
    const dayDate = new Date(sow); dayDate.setDate(sow.getDate()+i);
    const dayName = dayOrder[i];
    const items = (map[dayName]||[])
      .filter(n=> selected.has(shows[n].c) && (includeNonRet || shows[n].ret !== false))
      .map(n=>{
        const sh = shows[n];
        const ep = episodeForDate(sh, dayDate);
        const cls = sh.ret ? '' : 'ended';
        const suffix = ep? ` <span class="muted">(${ep})</span>` : '';
        return `${span(n,sh.c)} <span class="${cls}">${sh.t}</span>${suffix}`;
      });
    html += `<td class="shows">${items.join('<br>') || '<em>No shows</em>'}</td>`;
  }
  html += '</tr></tbody></table>';
  wrap.innerHTML = html;
}
function endDateFor(show){
  if(show && show.end) return show.end;
  if(!show || !show.start || !show.eps) return '';
  const start = new Date(show.start + 'T00:00:00');
  const last = new Date(start);
  last.setDate(start.getDate() + (show.eps - 1) * 7);
  return `${last.getFullYear()}-${pad(last.getMonth()+1)}-${pad(last.getDate())}`;
}
let weekOffset = 0; // weeks relative to current week
function currentWeekStart(){
  const base = startOfWeek(new Date());
  const d = new Date(base);
  d.setDate(base.getDate() + weekOffset*7);
  return d;
}
function setMode(mode){
  const allBtn = document.getElementById('btnAll');
  const weekBtn = document.getElementById('btnWeek');
  const allView = document.getElementById('viewAll');
  const weekView = document.getElementById('viewWeek');
  if(mode==='all'){
    allView.classList.remove('hidden');
    weekView.classList.add('hidden');
    allBtn.classList.add('active');
    weekBtn.classList.remove('active');
  } else {
    weekView.classList.remove('hidden');
    allView.classList.add('hidden');
    weekBtn.classList.add('active');
    allBtn.classList.remove('active');
  }
}
function getSelectedPlatforms(){
  const set = new Set();
  if(document.getElementById('pf-hulu').checked) set.add('hulu');
  if(document.getElementById('pf-peacock').checked) set.add('peacock');
  if(document.getElementById('pf-paramount').checked) set.add('paramount');
  return set;
}
function loadPersisted(){
  try{
    const raw = localStorage.getItem('showsSeasonData');
    if(!raw) return;
    const data = JSON.parse(raw);
    Object.keys(data).forEach(k=>{
      if(shows[k]) Object.assign(shows[k], data[k]);
    });
  }catch(e){/* ignore */}
}
function savePersisted(){
  const out = {};
  Object.keys(shows).forEach(k=>{
    const {s,start,end,eps,air,ret} = shows[k];
    out[k] = {s,start,end,eps,air,ret};
  });
  localStorage.setItem('showsSeasonData', JSON.stringify(out));
}
function renderEditor(){
  const wrap = document.getElementById('editWrap');
  let html = '<table><thead><tr><th>#</th><th>Title</th><th>Platform</th><th>Air Day</th><th>Season</th><th>Start</th><th>End</th><th>Eps</th><th>Returning</th></tr></thead><tbody>';
  const nums = Object.keys(shows).map(k=>parseInt(k)).sort((a,b)=>a-b);
  nums.forEach(n=>{
    const sh = shows[n];
    html += `<tr>
      <td>${n}</td>
      <td>${sh.t}</td>
      <td><span class="${sh.c} chip">${sh.c}</span></td>
      <td>
        <select data-k="${n}" data-f="air">
          ${['','Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'].map(d=>`<option value="${d}" ${sh.air===d?'selected':''}>${d||'—'}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" min="1" data-k="${n}" data-f="s" value="${sh.s??''}"></td>
      <td><input type="date" data-k="${n}" data-f="start" value="${sh.start||''}"></td>
      <td><input type="date" data-k="${n}" data-f="end" value="${sh.end||''}"></td>
      <td><input type="number" min="1" data-k="${n}" data-f="eps" value="${sh.eps??''}"></td>
      <td style="text-align:center"><input type="checkbox" data-k="${n}" data-f="ret" ${sh.ret?'checked':''}></td>
    </tr>`;
  });
  html += '</tbody></table><div style="margin-top:8px;"><button id="saveEdits" type="button">Save Changes</button> <span class="muted">Saves locally in your browser</span></div>';
  wrap.innerHTML = html;
  document.getElementById('saveEdits').addEventListener('click', ()=>{
    const inputs = wrap.querySelectorAll('[data-k]');
    inputs.forEach(el=>{
      const k = el.getAttribute('data-k');
      const f = el.getAttribute('data-f');
      let val;
      if(el.type==='checkbox') val = el.checked; else val = el.value;
      if(f==='s' || f==='eps') val = val? parseInt(val,10): null;
      shows[k][f] = (val===''? '': val);
    });
    savePersisted();
    reRender();
  });
  document.getElementById('loadPaste').addEventListener('click', ()=>{
    const txt = (document.getElementById('pasteJson').value||'').trim();
    if(!txt) return;
    try{
      const data = JSON.parse(txt);
      applyPreload(data);
      savePersisted();
      reRender();
      alert('Loaded season data from pasted JSON.');
    }catch(e){ alert('Invalid JSON.'); }
  });
}
function reRender(){
  renderLegend();
  renderAll();
  renderWeek();
}
document.getElementById('btnAll').addEventListener('click',()=>setMode('all'));
document.getElementById('btnWeek').addEventListener('click',()=>setMode('week'));
['pf-hulu','pf-peacock','pf-paramount'].forEach(id=>{
  document.getElementById(id).addEventListener('change', reRender);
});
document.getElementById('show-nonret').addEventListener('change', reRender);
['use-estimates','est-abc','est-nbc','est-cbs','est-fox'].forEach(id=>{
  document.getElementById(id).addEventListener('change', reRender);
});
function applyPreload(data){
  if(!data) return;
  Object.keys(data).forEach(k=>{
    if(shows[k]) Object.assign(shows[k], data[k]);
  });
}
// Wire week navigation
document.getElementById('prevWeek').addEventListener('click', ()=>{ weekOffset--; renderWeek(); });
document.getElementById('thisWeek').addEventListener('click', ()=>{ weekOffset=0; renderWeek(); });
document.getElementById('nextWeek').addEventListener('click', ()=>{ weekOffset++; renderWeek(); });
document.getElementById('jumpDate').addEventListener('change', (e)=>{
  const v = e.target.value; if(!v) return;
  const d = new Date(v+'T00:00:00');
  const base = startOfWeek(new Date());
  const target = startOfWeek(d);
  const diffDays = Math.round((target-base)/(1000*60*60*24));
  weekOffset = Math.round(diffDays/7);
  renderWeek();
});

// Initialize
applyPreload(PRELOAD_SEASON_DATA);
loadPersisted();
renderEditor();
reRender();

// Import / Export wiring
document.getElementById('importBtn').addEventListener('click', ()=>{
  document.getElementById('importFile').click();
});
document.getElementById('importFile').addEventListener('change', (e)=>{
  const file = e.target.files && e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const data = JSON.parse(reader.result);
      applyPreload(data);
      savePersisted();
      reRender();
      alert('Imported season data from JSON file.');
    }catch(err){ alert('Invalid JSON file.'); }
  };
  reader.readAsText(file);
});
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const out = {};
  Object.keys(shows).forEach(k=>{
    const {s,start,end,eps,air,ret} = shows[k];
    out[k] = {s,start,end,eps,air,ret};
  });
  const blob = new Blob([JSON.stringify(out, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'season-data.json';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>